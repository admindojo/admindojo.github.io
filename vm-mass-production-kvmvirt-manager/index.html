<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>VM mass production with libvirt/virt-manager - blog.admindojo.org</title><meta name="description" content="It can be tempting to use fancy tools like XEN, VMware or Proxmox - but these tools also come with additional requirements, overhead and quite a large documentation."><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.admindojo.org/vm-mass-production-kvmvirt-manager/"><link rel="amphtml" href="https://blog.admindojo.org/amp/vm-mass-production-kvmvirt-manager/"><link type="application/atom+xml" rel="alternate" href="https://blog.admindojo.org/feed.xml"><meta property="og:title" content="VM mass production with libvirt/virt-manager"><meta property="og:image" content="https://blog.admindojo.org/media/posts/3/ivan-bandura-N_FDXbXwQmc-unsplash.jpg"><meta property="og:site_name" content="blog.admindojo.org"><meta property="og:description" content="It can be tempting to use fancy tools like XEN, VMware or Proxmox - but these tools also come with additional requirements, overhead and quite a large documentation."><meta property="og:url" content="https://blog.admindojo.org/vm-mass-production-kvmvirt-manager/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@6uhrmittag"><meta name="twitter:title" content="VM mass production with libvirt/virt-manager"><meta name="twitter:description" content="It can be tempting to use fancy tools like XEN, VMware or Proxmox - but these tools also come with additional requirements, overhead and quite a large documentation."><meta name="twitter:image" content="https://blog.admindojo.org/media/posts/3/ivan-bandura-N_FDXbXwQmc-unsplash.jpg"><link rel="shortcut icon" href="https://blog.admindojo.org/media/website/favicon-1.ico" type="image/x-icon"><link rel="stylesheet" href="https://blog.admindojo.org/assets/css/style.css?v=ad6f1b67a5645325561dbc9e5a7ccfee"><link rel="stylesheet" href="https://blog.admindojo.org/assets/css/prism-default.css?v=9744853d64d710edcae61a3d59a17ee2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.admindojo.org/vm-mass-production-kvmvirt-manager/"},"headline":"VM mass production with libvirt/virt-manager","datePublished":"2019-07-11T02:17","dateModified":"2019-07-17T22:21","image":{"@type":"ImageObject","url":"https://blog.admindojo.org/media/posts/3/ivan-bandura-N_FDXbXwQmc-unsplash.jpg","height":3955,"width":2225},"description":"<p>It can be tempting to use fancy tools like XEN, VMware or Proxmox - but these tools also come with additional requirements, overhead and quite a large documentation.</p>\n","author":{"@type":"Person","name":"marvin"},"publisher":{"@type":"Organization","name":"marvin"}}</script><script async src="https://blog.admindojo.org/assets/js/lazysizes.min.js?v=300b16f1c14e1537e6b064f464ab33b1"></script></head><body><header class="header" id="js-header"><a class="logo" href="https://blog.admindojo.org/">blog.admindojo.org</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://blog.admindojo.org/tag/infrastructure/" target="_self">infrastructure</a></li><li><a href="https://blog.admindojo.org/tag/coding/" target="_self">coding</a></li><li><a href="https://blog.admindojo.org/tag/today-i-learned/" target="_self">today-I-learned</a></li><li><span class="is-separator">|</span></li><li><a href="https://admindojo.org" target="_blank">admindojo.org</a></li></ul></nav></header><main><div class="container"><div class="content content--center"><article class="post post-blog"><header class="post-blog__header"><h1>VM mass production with libvirt/virt-manager</h1><ul class="post-blog__meta"><li><address class="post-blog__author"><img src="https://blog.admindojo.org/media/website/profilfoto_transparent.png" alt="marvin"> <a rel="author" href="https://blog.admindojo.org/authors/marvin/">marvin</a></address></li><li><time datetime="2019-07-17T22:21">July 17, 2019</time></li><li>Published in: <a href="https://blog.admindojo.org/tag/infrastructure/" class="post-blog__tag">infrastructure</a></li></ul></header><div class="post__entry"><p>It can be tempting to use fancy tools like XEN, VMware or Proxmox - but these tools also come with additional requirements, overhead and quite a large documentation.</p><p>And while these specialized tools can simplify complex infrastructures, the setup shouldn't delay the first milestone: a working host that quickly spawns new VMs.<br>Choosing the simplest tool for the job helps to reach a stable milestone faster.</p><p class="msg msg--info msg--highlight msg--success">A stable state can be upgraded quicker than a feature-rich state that doesn't work.</p><h2>Almost bare metal: KVM</h2><p><span style="font-size: inherit;">Even though container would use less resources, VMs are a bit easier to work with. I'm going with KVM, QEMU, libvirt and virt-manager on a Ubuntu Bionic LTS host.<br><br>I'm prefer a universal Ubuntu host over a specialized hypervisor/OS - like Xen or oVirt(which requires RedHat/CentOS) - simply because I know Ubuntu and the OS is still fully accessible(to install stuff in parallel).<br><br>Virt-manager doesn't look fancy, but gets the job done - and the </span><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-creating_guests_with_virt_manager" target="_blank" rel="noopener noreferrer" style="font-size: inherit;">documentation at RedHat is great.</a></p><h2>apt install -y virt-manager</h2>Installation is simple: <code>sudo apt install -y virt-manager</code> installs everything needed.<br><h2>Shortcut: skipping dedicated DHCP/DNS</h2><p class="msg msg--highlight">Setting up a special subnet, nameserver or even VLAN can be fun - but 10 VMs won't kill the home router.</p><p>This does depend on the internet connection, but typically a internet service provider does supply/require some sort of router which usually has DHCP and DNS enabled by default - why not just use these in the beginning?!</p><p>The AVM FritzBox router is the default ISP router in Germany and meets the requirements. It also provides the local domain<code>fritz.box</code> which - isn't pretty, but - works out of the box. The main goal is to get started quickly -<code>ssh $name.fritz.box</code> is fine. </p><p class="msg msg--highlight">At the time the homelab requires a dedicated DNS/DHCP a global configuration management tool like Puppet should be in place anyway.</p><figure class="post__image--center align-center"><img class="lazyload" src="https://blog.admindojo.org/media/posts/3/responsive/WmRbmf5-xs.png" data-sizes="auto" data-srcset="https://blog.admindojo.org/media/posts/3/responsive/WmRbmf5-xs.png 300w ,https://blog.admindojo.org/media/posts/3/responsive/WmRbmf5-sm.png 480w ,https://blog.admindojo.org/media/posts/3/responsive/WmRbmf5-md.png 749w" alt="Meme: It is always DNS" width="601" height="358"></figure><p class="msg msg--info"><strong>Bonus TIL</strong>: The FritzBox doesn't handle duplicate hostnames very well. Check DNS and remove duplicates manually.</p><h2>Building bridges</h2><p>To use the existing DHCP server, all VMs require full network access - which isn't the default in most cases. Libvirt comes with a NAT network by default, which is nice to not interfere with the existing network, but it makes things complicated: NAT would require thinks like port-forwarding on the host and a reverse-proxy for web servers - maybe later.<br><br>For now, each VM should get it's IP directly via DHCP from the router - direct access via port 22 from anywhere within the network.</p><p>Nice side effect: <a href="https://netplan.io/examples#configuring-network-bridges" target="_blank" rel="noopener noreferrer">This setup only requires 5 lines in the netplan configuration.</a></p><footer><div class="post-blog__share"><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.admindojo.org%2Fvm-mass-production-kvmvirt-manager%2F&amp;via=6uhrmittag&amp;text=VM%20mass%20production%20with%20libvirt%2Fvirt-manager" class="btn btn--outline btn--icon js-share twitter" title="Share with Twitter" rel="nofollow"><svg height="1.25em" width="1.25em" aria-hidden="true"><use xlink:href="https://blog.admindojo.org/assets/svg/svg-map.svg#twitter"/></svg> Twitter </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.admindojo.org%2Fvm-mass-production-kvmvirt-manager%2F&amp;title=VM%20mass%20production%20with%20libvirt%2Fvirt-manager" class="btn btn--outline btn--icon js-share linkedin" title="Share with LinkedIn" rel="nofollow"><svg height="1.25em" width="1.25em" aria-hidden="true"><use xlink:href="https://blog.admindojo.org/assets/svg/svg-map.svg#linkedin"/></svg> LinkedIn</a></div><dl class="post__tag post-blog__tag"><dt>Tags:</dt><dd><a href="https://blog.admindojo.org/tag/infrastructure/" title="infrastructure">infrastructure</a></dd></dl><nav><ul class="post__nav"><li class="post__nav-prev">Prev: <a href="https://blog.admindojo.org/homelab-just-a-hhd-away/" rel="prev" title="Homelab - just a HDD away">Homelab - just a HDD away</a></li><li class="post__nav-next">Next: <a href="https://blog.admindojo.org/everything-is-your-own-fault-downside-of-virt-manager/" rel="next" title="Everything Is Your Own Fault - Downside of virt-manager">Everything Is Your Own Fault - Downside of virt-manager</a></li></ul></nav></footer></div></article><div class="comments"><h3>Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                          this.page.url = 'https://blog.admindojo.org/vm-mass-production-kvmvirt-manager/';
                  		this.page.identifier = '3';
                          this.page.title = ' VM mass production with libvirt/virt-manager';
                      };
                  
                      var disqus_loaded = false;
                  
                      function publiiLoadDisqus() {
                          if(disqus_loaded) {
                              return false;
                          }
                  
                          var top = document.getElementById('disqus_thread').offsetTop;
                  
                          if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                              disqus_loaded = true;
                  
                              (function () {
                                  var d = document, s = d.createElement('script');
                                  s.src = 'https://admindojoorg.disqus.com/embed.js';
                                  s.setAttribute('data-timestamp', +new Date());
                                  (d.head || d.body).appendChild(s);
                              })();
                          }
                      }
                  
                      publiiLoadDisqus();
                  
                      window.onscroll = function() {
                          publiiLoadDisqus();
                      };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://blog.admindojo.org/">blog.admindojo.org</a></div><div><div class="footer__copy"><a href="https://getpublii.com/" rel="nofollow">Powered by Publii CMS for Static Website</a></div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://blog.admindojo.org/assets/js/scripts.min.js?v=35849a2ae782a7cffb53b761b91e477d"></script><script defer="defer" src="https://blog.admindojo.org/assets/js/prism.js?v=6239ca4269ba0b11f919c3f7ec31aa99"></script><script defer="defer" src="https://blog.admindojo.org/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://blog.admindojo.org/assets/js/prism-copy-to-clipboard.min.js?v=fabfc3fd9af83cda5208ba2e9f9ed238"></script></body></html>